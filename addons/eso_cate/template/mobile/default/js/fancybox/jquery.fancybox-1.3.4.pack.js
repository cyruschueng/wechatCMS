/*
 * FancyBox - jQuery Plugin
 * Simple and fancy lightbox alternative
 *
 * Examples and documentation at: http://fancybox.net
 *
 * Copyright (c) 2008 - 2010 Janis Skarnelis
 * That said, it is hardly a one-person project. Many people have submitted bugs, code, and offered their advice freely. Their support is greatly appreciated.
 *
 * Version: 1.3.4 (11/11/2010)
 * Requires: jQuery v1.3+
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */

(function(a){var l,q,r,f,y,k,z,g,v,w,o=0,c={},m=[],n=0,b={},j=[],B=null,s=new Image,D=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,O=/[^\.]\.(swf)\s*$/i,E,F=1,u=0,t="",p,h,i=false,x=a.extend(a("<div/>")[0],{prop:0}),G=a.browser.msie&&a.browser.version<7&&!window.XMLHttpRequest,H=function(){q.hide();s.onerror=s.onload=null;B&&B.abort();l.empty()},I=function(){false===c.onError(m,o,c)?(q.hide(),i=false):(c.titleShow=false,c.width="auto",c.height="auto",l.html('<p id="fancybox-error">The requested content cannot be loaded.<br />Please try again later.</p>'), A())},C=function(){var d=m[o],e,b,f,h,j,g;H();c=a.extend({},a.fn.fancybox.defaults,typeof a(d).data("fancybox")=="undefined"?c:a(d).data("fancybox"));g=c.onStart(m,o,c);if(g===false)i=false;else{typeof g=="object"&&(c=a.extend(c,g));f=c.title||(d.nodeName?a(d).attr("title"):d.title)||"";if(d.nodeName&&!c.orig)c.orig=a(d).children("img:first").length?a(d).children("img:first"):a(d);f===""&&c.orig&&c.titleFromAlt&&(f=c.orig.attr("alt"));e=c.href||(d.nodeName?a(d).attr("href"):d.href)||null;if(/^(?:javascript)/i.test(e)|| e=="#")e=null;if(c.type){if(b=c.type,!e)e=c.content}else c.content?b="html":e&&(b=e.match(D)?"image":e.match(O)?"swf":a(d).hasClass("iframe")?"iframe":e.indexOf("#")===0?"inline":"ajax");if(b){b=="inline"&&(d=e.substr(e.indexOf("#")),b=a(d).length>0?"inline":"ajax");c.type=b;c.href=e;c.title=f;if(c.autoDimensions)c.type=="html"||c.type=="inline"||c.type=="ajax"?(c.width="auto",c.height="auto"):c.autoDimensions=false;if(c.modal)c.overlayShow=true,c.hideOnOverlayClick=false,c.hideOnContentClick=false, c.enableEscapeButton=false,c.showCloseButton=false;c.padding=parseInt(c.padding,10);c.margin=parseInt(c.margin,10);l.css("padding",c.padding+c.margin);a(".fancybox-inline-tmp").unbind("fancybox-cancel").bind("fancybox-change",function(){a(this).replaceWith(k.children())});switch(b){case "html":l.html(c.content);A();break;case "inline":if(a(d).parent().is("#fancybox-content")===true){i=false;break}a('<div class="fancybox-inline-tmp" />').hide().insertBefore(a(d)).bind("fancybox-cleanup",function(){a(this).replaceWith(k.children())}).bind("fancybox-cancel", function(){a(this).replaceWith(l.children())});a(d).appendTo(l);A();break;case "image":i=false;a.fancybox.showActivity();s=new Image;s.onerror=function(){I()};s.onload=function(){i=true;s.onerror=s.onload=null;c.width=s.width;c.height=s.height;a("<img />").attr({id:"fancybox-img",src:s.src,alt:c.title}).appendTo(l);J()};s.src=e;break;case "swf":c.scrolling="no";h='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+c.width+'" height="'+c.height+'"><param name="movie" value="'+e+ '"></param>';j="";a.each(c.swf,function(a,d){h+='<param name="'+a+'" value="'+d+'"></param>';j+=" "+a+'="'+d+'"'});h+='<embed src="'+e+'" type="application/x-shockwave-flash" width="'+c.width+'" height="'+c.height+'"'+j+"></embed></object>";l.html(h);A();break;case "ajax":i=false;a.fancybox.showActivity();c.ajax.win=c.ajax.success;B=a.ajax(a.extend({},c.ajax,{url:e,data:c.ajax.data||{},error:function(a){a.status>0&&I()},success:function(a,d,b){if((typeof b=="object"?b:B).status==200){if(typeof c.ajax.win== "function")if(g=c.ajax.win(e,a,d,b),g===false){q.hide();return}else if(typeof g=="string"||typeof g=="object")a=g;l.html(a);A()}}}));break;case "iframe":J()}}else I()}},A=function(){var d=c.width,b=c.height,d=d.toString().indexOf("%")>-1?parseInt((a(window).width()-c.margin*2)*parseFloat(d)/100,10)+"px":d=="auto"?"auto":d+"px",b=b.toString().indexOf("%")>-1?parseInt((a(window).height()-c.margin*2)*parseFloat(b)/100,10)+"px":b=="auto"?"auto":b+"px";l.wrapInner('<div style="width:'+d+";height:"+b+";overflow: "+ (c.scrolling=="auto"?"auto":c.scrolling=="yes"?"scroll":"hidden")+';position:relative;"></div>');c.width=l.width();c.height=l.height();J()},J=function(){var d,e;q.hide();if(f.is(":visible")&&false===b.onCleanup(j,n,b))a.event.trigger("fancybox-cancel"),i=false;else{i=true;a(k.add(r)).unbind();a(window).unbind("resize.fb scroll.fb");a(document).unbind("keydown.fb");f.is(":visible")&&b.titlePosition!=="outside"&&f.css("height",f.height());j=m;n=o;b=c;if(b.overlayShow){var P=a(document).height();r.css({"background-color":b.overlayColor, opacity:b.overlayOpacity,"-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=30)",cursor:b.hideOnOverlayClick?"pointer":"auto",height:P});if(!r.is(":visible")){if(G)a("select:not(#fancybox-tmp select)").filter(function(){return this.style.visibility!=="hidden"}).css({visibility:"hidden"}).one("fancybox-cleanup",function(){this.style.visibility="inherit"});r.show()}}else r.hide();h=Q();t=b.title||"";u=0;g.empty().removeAttr("style").removeClass();if(b.titleShow!==false&&(t=a.isFunction(b.titleFormat)? b.titleFormat(t,j,n,b):t&&t.length?b.titlePosition=="float"?'<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">'+t+'</td><td id="fancybox-title-float-right"></td></tr></table>':'<div id="fancybox-title-'+b.titlePosition+'">'+t+"</div>":false)&&t!=="")switch(g.addClass("fancybox-title-"+b.titlePosition).html(t).appendTo("body").show(),b.titlePosition){case "inside":g.css({width:h.width-b.padding*2,marginLeft:b.padding, marginRight:b.padding});u=g.outerHeight(true);g.appendTo(y);h.height+=u;break;case "over":g.css({marginLeft:b.padding,width:h.width-b.padding*2,bottom:b.padding}).appendTo(y);break;case "float":g.css("left",parseInt((g.width()-h.width-40)/2,10)*-1).appendTo(f);break;default:g.css({width:h.width-b.padding*2,paddingLeft:b.padding,paddingRight:b.padding}).appendTo(f)}g.hide();if(f.is(":visible"))a(z.add(v).add(w)).hide(),d=f.position(),p={top:d.top,left:d.left,width:f.width(),height:f.height()},e=p.width== h.width&&p.height==h.height,k.fadeTo(b.changeFade,0.3,function(){var d=function(){k.html(l.contents()).fadeTo(b.changeFade,1,K)};a.event.trigger("fancybox-change");k.empty().removeAttr("filter").css({"border-width":b.padding,width:h.width-b.padding*2,height:c.autoDimensions?"auto":h.height-u-b.padding*2});e?d():(x.prop=0,a(x).animate({prop:1},{duration:b.changeSpeed,easing:b.easingChange,step:L,complete:d}))});else if(f.removeAttr("style"),k.css("border-width",b.padding),b.transitionIn=="elastic"){p= N();k.html(l.contents());f.show();if(b.opacity)h.opacity=0;x.prop=0;a(x).animate({prop:1},{duration:b.speedIn,easing:b.easingIn,step:L,complete:K})}else b.titlePosition=="inside"&&u>0&&g.show(),k.css({width:h.width-b.padding*2,height:c.autoDimensions?"auto":h.height-u-b.padding*2}).html(l.contents()),f.css(h).fadeIn(b.transitionIn=="none"?0:b.speedIn,K)}},R=function(){(b.enableEscapeButton||b.enableKeyboardNav)&&a(document).bind("keydown.fb",function(d){if(d.keyCode==27&&b.enableEscapeButton)d.preventDefault(), a.fancybox.close();else if((d.keyCode==37||d.keyCode==39)&&b.enableKeyboardNav&&d.target.tagName!=="INPUT"&&d.target.tagName!=="TEXTAREA"&&d.target.tagName!=="SELECT")d.preventDefault(),a.fancybox[d.keyCode==37?"prev":"next"]()});b.showNavArrows?((b.cyclic&&j.length>1||n!==0)&&v.show(),(b.cyclic&&j.length>1||n!=j.length-1)&&w.show()):(v.hide(),w.hide())},K=function(){a.support.opacity||(k.get(0).style.removeAttribute("filter"),f.get(0).style.removeAttribute("filter"));c.autoDimensions&&k.css("height", "auto");f.css("height","auto");t&&t.length&&g.show();b.showCloseButton&&z.show();R();b.hideOnContentClick&&k.bind("click",a.fancybox.close);b.hideOnOverlayClick&&r.bind("click",a.fancybox.close);a(window).bind("resize.fb",a.fancybox.resize);b.centerOnScroll&&a(window).bind("scroll.fb",a.fancybox.center);b.type=="iframe"&&a('<iframe id="fancybox-frame" name="fancybox-frame'+(new Date).getTime()+'" frameborder="0" hspace="0" '+(a.browser.msie?'allowtransparency="true""':"")+' scrolling="'+c.scrolling+ '" src="'+b.href+'"></iframe>').appendTo(k);f.show();i=false;a.fancybox.center();b.onComplete(j,n,b);var d,e;if(j.length-1>n&&(d=j[n+1].href,typeof d!=="undefined"&&d.match(D)))e=new Image,e.src=d;if(n>0&&(d=j[n-1].href,typeof d!=="undefined"&&d.match(D)))e=new Image,e.src=d},L=function(a){var e={width:parseInt(p.width+(h.width-p.width)*a,10),height:parseInt(p.height+(h.height-p.height)*a,10),top:parseInt(p.top+(h.top-p.top)*a,10),left:parseInt(p.left+(h.left-p.left)*a,10)};if(typeof h.opacity!== "undefined")e.opacity=a<0.5?0.5:a;f.css(e);k.css({width:e.width-b.padding*2,height:e.height-u*a-b.padding*2})},M=function(){return[a(window).width()-b.margin*2,a(window).height()-b.margin*2,a(document).scrollLeft()+b.margin,a(document).scrollTop()+b.margin]},Q=function(){var a=M(),e={},f=b.autoScale,g=b.padding*2;e.width=b.width.toString().indexOf("%")>-1?parseInt(a[0]*parseFloat(b.width)/100,10):b.width+g;e.height=b.height.toString().indexOf("%")>-1?parseInt(a[1]*parseFloat(b.height)/100,10):b.height+ g;if(f&&(e.width>a[0]||e.height>a[1]))if(c.type=="image"||c.type=="swf"){f=b.width/b.height;if(e.width>a[0])e.width=a[0],e.height=parseInt((e.width-g)/f+g,10);if(e.height>a[1])e.height=a[1],e.width=parseInt((e.height-g)*f+g,10)}else e.width=Math.min(e.width,a[0]),e.height=Math.min(e.height,a[1]);e.top=parseInt(Math.max(a[3]-20,a[3]+(a[1]-e.height-40)*0.5),10);e.left=parseInt(Math.max(a[2]-20,a[2]+(a[0]-e.width-40)*0.5),10);return e},N=function(){var d=c.orig?a(c.orig):false,e={};d&&d.length?(e=d.offset(), e.top+=parseInt(d.css("paddingTop"),10)||0,e.left+=parseInt(d.css("paddingLeft"),10)||0,e.top+=parseInt(d.css("border-top-width"),10)||0,e.left+=parseInt(d.css("border-left-width"),10)||0,e.width=d.width(),e.height=d.height(),e={width:e.width+b.padding*2,height:e.height+b.padding*2,top:e.top-b.padding-20,left:e.left-b.padding-20}):(d=M(),e={width:b.padding*2,height:b.padding*2,top:parseInt(d[3]+d[1]*0.5,10),left:parseInt(d[2]+d[0]*0.5,10)});return e},S=function(){q.is(":visible")?(a("div",q).css("top", F*-40+"px"),F=(F+1)%12):clearInterval(E)};a.fn.fancybox=function(b){if(!a(this).length)return this;a(this).data("fancybox",a.extend({},b,a.metadata?a(this).metadata():{})).unbind("click.fb").bind("click.fb",function(b){b.preventDefault();i||(i=true,a(this).blur(),m=[],o=0,b=a(this).attr("rel")||"",!b||b==""||b==="nofollow"?m.push(this):(m=a("a[rel="+b+"], area[rel="+b+"]"),o=m.index(this)),C())});return this};a.fancybox=function(b,e){var c;if(!i){i=true;c=typeof e!=="undefined"?e:{};m=[];o=parseInt(c.index, 10)||0;if(a.isArray(b)){for(var f=0,g=b.length;f<g;f++)typeof b[f]=="object"?a(b[f]).data("fancybox",a.extend({},c,b[f])):b[f]=a({}).data("fancybox",a.extend({content:b[f]},c));m=jQuery.merge(m,b)}else typeof b=="object"?a(b).data("fancybox",a.extend({},c,b)):b=a({}).data("fancybox",a.extend({content:b},c)),m.push(b);if(o>m.length||o<0)o=0;C()}};a.fancybox.showActivity=function(){clearInterval(E);q.show();E=setInterval(S,66)};a.fancybox.hideActivity=function(){q.hide()};a.fancybox.next=function(){return a.fancybox.pos(n+ 1)};a.fancybox.prev=function(){return a.fancybox.pos(n-1)};a.fancybox.pos=function(a){i||(a=parseInt(a),m=j,a>-1&&a<j.length?(o=a,C()):b.cyclic&&j.length>1&&(o=a>=j.length?0:j.length-1,C()))};a.fancybox.cancel=function(){i||(i=true,a.event.trigger("fancybox-cancel"),H(),c.onCancel(m,o,c),i=false)};a.fancybox.close=function(){function d(){r.fadeOut("fast");g.empty().hide();f.hide();a.event.trigger("fancybox-cleanup");k.empty();b.onClosed(j,n,b);j=c=[];n=o=0;b=c={};i=false}if(!i&&!f.is(":hidden"))if(i= true,b&&false===b.onCleanup(j,n,b))i=false;else if(H(),a(z.add(v).add(w)).hide(),a(k.add(r)).unbind(),a(window).unbind("resize.fb scroll.fb"),a(document).unbind("keydown.fb"),k.find("iframe").attr("src",G&&/^https/i.test(window.location.href||"")?"javascript:void(false)":"about:blank"),b.titlePosition!=="inside"&&g.empty(),f.stop(),b.transitionOut=="elastic"){p=N();var e=f.position();h={top:e.top,left:e.left,width:f.width(),height:f.height()};if(b.opacity)h.opacity=1;g.empty().hide();x.prop=1;a(x).animate({prop:0}, {duration:b.speedOut,easing:b.easingOut,step:L,complete:d})}else f.fadeOut(b.transitionOut=="none"?0:b.speedOut,d)};a.fancybox.resize=function(){r.is(":visible")&&r.css("height",a(document).height());a.fancybox.center(true)};a.fancybox.center=function(a){var c,g;if(!i&&(g=a===true?1:0,c=M(),g||!(f.width()>c[0]||f.height()>c[1])))f.stop().animate({top:parseInt(Math.max(c[3]-20,c[3]+(c[1]-k.height()-40)*0.5-b.padding)),left:parseInt(Math.max(c[2]-20,c[2]+(c[0]-k.width()-40)*0.5-b.padding))},typeof a== "number"?a:200)};a.fancybox.init=function(){a("#fancybox-wrap").length||(a("body").append(l=a('<div id="fancybox-tmp"></div>'),q=a('<div id="fancybox-loading"><div></div></div>'),r=a('<div id="fancybox-overlay"></div>'),f=a('<div id="fancybox-wrap"></div>')),y=a('<div id="fancybox-outer"></div>').append('<div class="fancybox-bg" id="fancybox-bg-n"></div><div class="fancybox-bg" id="fancybox-bg-ne"></div><div class="fancybox-bg" id="fancybox-bg-e"></div><div class="fancybox-bg" id="fancybox-bg-se"></div><div class="fancybox-bg" id="fancybox-bg-s"></div><div class="fancybox-bg" id="fancybox-bg-sw"></div><div class="fancybox-bg" id="fancybox-bg-w"></div><div class="fancybox-bg" id="fancybox-bg-nw"></div>').appendTo(f), y.append(k=a('<div id="fancybox-content"></div>'),z=a('<a id="fancybox-close"></a>'),g=a('<div id="fancybox-title"></div>'),v=a('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),w=a('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>')),z.click(a.fancybox.close),q.click(a.fancybox.cancel),v.click(function(b){b.preventDefault();a.fancybox.prev()}),w.click(function(b){b.preventDefault();a.fancybox.next()}), a.fn.mousewheel&&f.bind("mousewheel.fb",function(b,c){if(i)b.preventDefault();else if(a(b.target).get(0).clientHeight==0||a(b.target).get(0).scrollHeight===a(b.target).get(0).clientHeight)b.preventDefault(),a.fancybox[c>0?"prev":"next"]()}),a.support.opacity||f.addClass("fancybox-ie"),G&&(q.addClass("fancybox-ie6"),f.addClass("fancybox-ie6"),a('<iframe id="fancybox-hide-sel-frame" src="'+(/^https/i.test(window.location.href||"")?"javascript:void(false)":"about:blank")+'" scrolling="no" border="0" frameborder="0" tabindex="-1"></iframe>').prependTo(y)))}; a.fn.fancybox.defaults={padding:0,margin:40,opacity:false,modal:false,cyclic:false,scrolling:"auto",width:560,height:340,autoScale:true,autoDimensions:true,centerOnScroll:false,ajax:{},swf:{wmode:"transparent"},hideOnOverlayClick:true,hideOnContentClick:false,overlayShow:true,overlayOpacity:0.3,overlayColor:"#000000",titleShow:false,titlePosition:"float",titleFormat:null,titleFromAlt:false,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing", easingOut:"swing",showCloseButton:true,showNavArrows:true,enableEscapeButton:true,enableKeyboardNav:true,onStart:function(){},onCancel:function(){},onComplete:function(){a("#fancybox-content input[type=text]").focus()},onCleanup:function(){},onClosed:function(){},onError:function(){}};a(document).ready(function(){a.fancybox.init()})})(jQuery);